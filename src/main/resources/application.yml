quarkus:
  application:
    name: OneEats Backend
    version: 1.0.0-SNAPSHOT

  telemetry:
    enabled: false

  # Serveur HTTP
  http:
    port: 8080
    host: 0.0.0.0  # Écouter sur toutes les interfaces pour permettre les connexions mobiles
    cors:
      ~: true
      origins:
        - http://localhost:3000
        - http://localhost:5173
        - http://localhost:8081
        - http://192.168.1.36:8080  # IP réseau pour appareils physiques
        - http://10.0.2.2:8080      # Android émulateur
      methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
      headers: accept,authorization,content-type,x-requested-with
      access-control-max-age: 86400

  # Base de données
  datasource:
    db-kind: postgresql
    username: ${DB_USER:oneeats_user}
    password: ${DB_PASSWORD:oneeats_password}
    jdbc:
      url: ${DB_URL:jdbc:postgresql://localhost:5432/oneeats_dev}
      max-size: 20
      min-size: 2

  hibernate-orm:
    database:
      generation: update
    log:
      sql: false
    metrics:
      enabled: true

  # Configuration Panache
  hibernate-orm-panache:
    enable-implicit-dirty-checking: true

  # Sérialisation Jackson
  jackson:
    serialization-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false
      write-durations-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

  # Logs
  log:
    level: INFO
    category:
      "com.oneeats": DEBUG
      "org.hibernate.SQL": DEBUG
    console:
      enable: true
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"

  # Santé et métriques
  smallrye-health:
    ui:
      enable: true

  micrometer:
    export:
      prometheus:
        enabled: true
        path: /metrics

  # Documentation OpenAPI
  smallrye-openapi:
    info-title: OneEats API
    info-version: 1.0.0
    info-description: API pour la plateforme OneEats - Commandes de restauration
    servers:
      - url: http://localhost:8080
        description: Serveur de développement

  # DevUI Configuration (fix startup issue)
  dev-ui:
    cors:
      enabled: true

  # Sécurité OIDC/Keycloak
  oidc:
    # URL du serveur Keycloak (port 8180 en dev)
    auth-server-url: ${KEYCLOAK_URL:http://localhost:8180}/realms/oneeats
    client-id: ${KEYCLOAK_CLIENT_ID:oneeats-backend}
    credentials:
      secret: ${KEYCLOAK_CLIENT_SECRET:oneeats-backend-secret-dev}
    # Mode hybrid: supporte cookies (web) ET Bearer tokens (mobile/API)
    application-type: hybrid
    # Configuration TLS
    tls:
      verification: none  # Uniquement pour le développement
    # Mapping des rôles depuis Keycloak
    roles:
      source: realm
      role-claim-path: realm_access/roles
    # Validation des tokens
    token:
      issuer: any  # Accepter l'issuer du token (dev)
      audience: ${KEYCLOAK_CLIENT_ID:oneeats-backend}
    # Chemins publics (pas d'auth requise)
    authentication:
      enabled: true

  # Configuration sécurité HTTP
  security:
    auth:
      enabled-in-dev-mode: true

  # Frontend intégration (Quinoa) - Production
  quinoa:
    enabled: true  # Désactivé par défaut, activé en dev/prod
    package-manager: npm
    package-manager-install: false
    build-dir: dist
    ui-dir: apps/web

    # SPA routing pour production
    spa-routing: true
    spa-routing-path: "/"
    spa-routing-ignored-paths: "/api/*,/q/*,/health*,/metrics*,/openapi*,/ws/*"

# Configuration métier OneEats
oneeats:
  business:
    order:
      max-items-per-order: 50
      default-preparation-time-minutes: 20
      max-preparation-time-minutes: 120
      pickup-reminder-minutes: 5
    restaurant:
      max-distance-km: 50
      default-rating: 0.0
    notification:
      enabled: true
      email-enabled: false  # Désactivé en dev
      sms-enabled: false    # Désactivé en dev

  # Limites et sécurité
  api:
    rate-limit:
      enabled: false  # À activer en production
      requests-per-minute: 60
    pagination:
      default-page-size: 20
      max-page-size: 100
