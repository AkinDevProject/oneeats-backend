# =============================================================================
# FLOW 03: Authentification - Connexion
# =============================================================================
# Teste l'ecran de connexion et ses elements
# Note: Le test SSO Keycloak est optionnel (depend de la config backend)
# =============================================================================

appId: com.oneeats.mobile
name: "03 - Authentication Login Flow"
tags:
  - smoke
  - auth
  - e2e

---

# -----------------------------------------------------------------------------
# SETUP: Lancement avec etat neuf (deconnecte)
# -----------------------------------------------------------------------------
- launchApp:
    clearState: true
    clearKeychain: true

# -----------------------------------------------------------------------------
# STEP 1: Attendre l'ecran de connexion
# -----------------------------------------------------------------------------
- extendedWaitUntil:
    visible: "OneEats"
    timeout: 45000

- takeScreenshot: "03-app-loaded"

# -----------------------------------------------------------------------------
# STEP 2: Verifier la page de connexion
# -----------------------------------------------------------------------------
- assertVisible:
    text: "OneEats"
    optional: true

- takeScreenshot: "03-login-screen"

# -----------------------------------------------------------------------------
# STEP 3: Verifier les boutons de connexion
# -----------------------------------------------------------------------------
- assertVisible:
    text: "Se connecter"
    optional: true

- assertVisible:
    text: "Google"
    optional: true

- assertVisible:
    text: "Apple"
    optional: true

- assertVisible:
    text: "Continuer sans compte"
    optional: true

- takeScreenshot: "03-login-options"

# -----------------------------------------------------------------------------
# STEP 4: Tester le mode invite (skip auth)
# -----------------------------------------------------------------------------
- tapOn:
    text: "Continuer sans compte"
    optional: true

- extendedWaitUntil:
    visible: "Accueil"
    timeout: 30000

- takeScreenshot: "03-guest-mode-success"
