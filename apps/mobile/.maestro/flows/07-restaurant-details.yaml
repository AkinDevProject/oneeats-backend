# =============================================================================
# FLOW 07: Consultation des details d'un restaurant
# =============================================================================
# Teste l'affichage des details restaurant et de son menu
# Tags: navigation, restaurant, e2e
# Prerequis: Au moins un restaurant disponible
# =============================================================================

appId: com.oneeats.mobile
name: "07 - Restaurant Details View"
tags:
  - navigation
  - restaurant
  - e2e
  - smoke

---

# -----------------------------------------------------------------------------
# SETUP: Acces a l'accueil avec restaurants
# -----------------------------------------------------------------------------
- launchApp:
    clearState: true

- extendedWaitUntil:
    visible:
      anyOf:
        - text: "Continuer sans compte"
        - text: "Restaurants"
    timeout: 15000

- runFlow:
    when:
      visible: "Continuer sans compte"
    commands:
      - tapOn: "Continuer sans compte"

# Attendre le chargement des restaurants
- extendedWaitUntil:
    visible:
      anyOf:
        - text: "Restaurants à proximité"
        - text: "résultat"
    timeout: 15000

- takeScreenshot: "07-home-with-restaurants"

# -----------------------------------------------------------------------------
# TEST 1: Selectionner le premier restaurant
# -----------------------------------------------------------------------------
- scroll:
    direction: DOWN

# Taper sur une carte restaurant (premier visible)
- tapOn:
    anyOf:
      - id: "restaurant-card-0"
      - text: "⭐"
    index: 0

# -----------------------------------------------------------------------------
# TEST 2: Verifier le chargement de la page restaurant
# -----------------------------------------------------------------------------
- extendedWaitUntil:
    visible:
      anyOf:
        - text: "Menu"
        - text: "Notre Menu"
        - text: "Chargement"
        - text: "Ouvert"
        - text: "Fermé"
    timeout: 10000

- takeScreenshot: "07-restaurant-loading"

# Attendre la fin du chargement
- extendedWaitUntil:
    notVisible: "Chargement du restaurant"
    timeout: 10000

# -----------------------------------------------------------------------------
# TEST 3: Verifier les informations du restaurant
# -----------------------------------------------------------------------------
# Nom du restaurant
- assertVisible:
    anyOf:
      - text: "Restaurant"
      - text: "Pizza"
      - text: "Burger"
      - text: "Sushi"

# Statut ouvert/ferme
- assertVisible:
    anyOf:
      - text: "Ouvert"
      - text: "Fermé"

# Note
- assertVisible:
    anyOf:
      - text: "⭐"
      - text: "★"

# Temps de preparation
- assertVisible:
    anyOf:
      - text: "min"
      - text: "Retrait"

- takeScreenshot: "07-restaurant-header"

# -----------------------------------------------------------------------------
# TEST 4: Verifier la presence du menu
# -----------------------------------------------------------------------------
- scroll:
    direction: DOWN

- assertVisible:
    anyOf:
      - text: "Menu"
      - text: "Entrées"
      - text: "Plats"
      - text: "€"

- takeScreenshot: "07-restaurant-menu"

# -----------------------------------------------------------------------------
# TEST 5: Verifier les categories du menu
# -----------------------------------------------------------------------------
- assertVisible:
    anyOf:
      - text: "Entrées"
      - text: "Plats"
      - text: "Pizzas"
      - text: "Burgers"
      - text: "Desserts"
      - text: "Boissons"
      - text: "Tout"

# -----------------------------------------------------------------------------
# TEST 6: Scroll dans le menu
# -----------------------------------------------------------------------------
- scroll:
    direction: DOWN

- scroll:
    direction: DOWN

- takeScreenshot: "07-menu-scrolled"

# -----------------------------------------------------------------------------
# TEST 7: Verifier la presence d'articles avec prix
# -----------------------------------------------------------------------------
- assertVisible:
    anyOf:
      - text: "€"
      - text: "EUR"

# -----------------------------------------------------------------------------
# TEST 8: Verifier le bouton d'ajout au panier (si visible)
# -----------------------------------------------------------------------------
- assertVisible:
    anyOf:
      - text: "Ajouter"
      - text: "+"
      - id: "add-to-cart"

# -----------------------------------------------------------------------------
# TEST 9: Retour a l'accueil
# -----------------------------------------------------------------------------
- scroll:
    direction: UP

- scroll:
    direction: UP

- back

# Verifier le retour
- extendedWaitUntil:
    visible:
      anyOf:
        - text: "Restaurants"
        - text: "Catégories"
    timeout: 5000

- takeScreenshot: "07-back-to-home"
