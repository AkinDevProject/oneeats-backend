# =============================================================================
# FLOW 10: Passage de commande (Checkout)
# =============================================================================
# UAT Scenario 15: Passer une commande
# Teste le flux complet de finalisation d'une commande
# =============================================================================

appId: com.oneeats.mobile
name: "10 - Checkout Flow"
tags:
  - order
  - smoke
  - uat-scenario-15

---

# -----------------------------------------------------------------------------
# SETUP: Lancer l'app et ajouter des articles au panier
# -----------------------------------------------------------------------------
- launchApp:
    clearState: true

- extendedWaitUntil:
    visible: ".*"
    timeout: 15000

- runFlow:
    when:
      visible: "Continuer sans compte"
    commands:
      - tapOn: "Continuer sans compte"

- extendedWaitUntil:
    visible: ".*proximit.*"
    timeout: 30000
    optional: true

# Ouvrir un restaurant
- scroll

- tapOn:
    label: "Restaurant.*"
    index: 0
    optional: true

- extendedWaitUntil:
    visible: "Menu"
    timeout: 10000
    optional: true

# Ajouter un article
- scroll

- tapOn:
    label: "Ajouter.*panier"
    index: 0
    optional: true

- takeScreenshot: "10-item-added"

# -----------------------------------------------------------------------------
# STEP 1: Aller au panier
# -----------------------------------------------------------------------------
- tapOn: "Panier"

- extendedWaitUntil:
    visible: "Panier"
    timeout: 5000

- takeScreenshot: "10-cart-with-items"

# -----------------------------------------------------------------------------
# STEP 2: Verifier la section heure de retrait
# -----------------------------------------------------------------------------
- scroll

- assertVisible:
    text: "Heure de retrait"
    optional: true

- takeScreenshot: "10-pickup-time-section"

# -----------------------------------------------------------------------------
# STEP 3: Selectionner une heure de retrait
# -----------------------------------------------------------------------------
- tapOn:
    id: "pickup-time.*"
    index: 0
    optional: true

- takeScreenshot: "10-pickup-time-selected"

# -----------------------------------------------------------------------------
# STEP 4: Remplir les informations client
# -----------------------------------------------------------------------------
- scroll

- assertVisible:
    text: "Vos informations"
    optional: true

# Nom complet
- tapOn:
    id: "customer-name-input"
    optional: true

- inputText: "Test Utilisateur"

# Telephone
- tapOn:
    id: "customer-phone-input"
    optional: true

- inputText: "0612345678"

- takeScreenshot: "10-customer-info-filled"

# -----------------------------------------------------------------------------
# STEP 5: Ajouter des instructions speciales (optionnel)
# -----------------------------------------------------------------------------
- tapOn:
    id: "customer-instructions-input"
    optional: true

- inputText: "Sans oignons svp"

- takeScreenshot: "10-special-instructions"

# -----------------------------------------------------------------------------
# STEP 6: Verifier le recapitulatif
# -----------------------------------------------------------------------------
- scroll

- assertVisible:
    text: "Sous-total"
    optional: true

- assertVisible:
    text: "Total"
    optional: true

- takeScreenshot: "10-order-summary"

# -----------------------------------------------------------------------------
# STEP 7: Verifier le bouton Commander
# -----------------------------------------------------------------------------
- assertVisible:
    text: "Commander"
    optional: true

- takeScreenshot: "10-checkout-button"

# -----------------------------------------------------------------------------
# STEP 8: Tenter de commander (necesssite authentification)
# -----------------------------------------------------------------------------
- tapOn:
    text: "Commander"
    optional: true

- takeScreenshot: "10-order-attempt"

# -----------------------------------------------------------------------------
# STEP 9: Gestion du cas non authentifie
# -----------------------------------------------------------------------------
# Si non connecte, un message devrait demander de se connecter
- extendedWaitUntil:
    visible: ".*connexion.*"
    timeout: 5000
    optional: true

- takeScreenshot: "10-auth-required"

# -----------------------------------------------------------------------------
# STEP 10: Si authentifie, verifier la confirmation
# -----------------------------------------------------------------------------
# En cas de succes, on devrait voir:
# - Un message de confirmation
# - Un numero de commande

- extendedWaitUntil:
    visible: ".*commande.*"
    timeout: 10000
    optional: true

- takeScreenshot: "10-order-confirmation"

# -----------------------------------------------------------------------------
# STEP 11: Retour a l'accueil
# -----------------------------------------------------------------------------
- tapOn: "Accueil"

- extendedWaitUntil:
    visible: ".*proximit.*"
    timeout: 5000

- takeScreenshot: "10-checkout-complete"